'use strict';

module.exports = {
  up: async (queryInterface, Sequelize) => {
    // 1. Menambahkan kolom item_batch_id ke tabel opnames
    // Sesuai dengan foreign key di model: item_batch_id
    await queryInterface.addColumn('opnames', 'item_batch_id', {
      type: Sequelize.INTEGER,
      allowNull: true, 
      references: {
        model: 'item_batches', // ✅ Menggunakan nama tabel 'item_batches' (Sesuai Model)
        key: 'id',
      },
      onUpdate: 'CASCADE',
      onDelete: 'SET NULL', 
    });

    // 2. Menambahkan kolom system_stock ke tabel opnames
    // Kolom ini wajib ada untuk mencatat stok sistem sebelum dirubah
    await queryInterface.addColumn('opnames', 'system_stock', {
      type: Sequelize.INTEGER,
      allowNull: false,
      defaultValue: 0,
    });

    // ⚠️ Opsional: Menghapus kolom batch_id lama jika sudah ada (jika Anda pernah menjalankan migration yang salah sebelumnya)
    // Cek di database Anda apakah kolom 'batch_id' sudah ada. Jika ada, sebaiknya hapus di down.
  },

  down: async (queryInterface, Sequelize) => {
    // Menghapus kolom item_batch_id
    await queryInterface.removeColumn('opnames', 'item_batch_id');
    
    // Menghapus kolom system_stock
    await queryInterface.removeColumn('opnames', 'system_stock');

    // ⚠️ Opsional: Anda mungkin perlu menambahkan kembali kolom 'batch_id' di sini 
    // jika migration ini membatalkan migration sebelumnya yang menggunakan nama tersebut.
  }
};